// //get objects and creates list
// var data = [ { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }, { "trackID": 2342233, "queuePos": 1, "trackLength": 3300, "currentPosition": 1200, "title": "Trap Doors", "artist": "Broken Bells", "albumArt": "http:\/\/o.scdn.co\/140\/477370b45bc8c9699a00d3a91caedaaab80294a6", "score": 23, "userID": "fb263342", "userName": "Little Sapeezy", "userPic": "http:\/\/profile.ak.fbcdn.net\/hprofile-ak-prn1\/c17.17.207.207\/s160x160\/537107_10200171096780868_1555243336_n.jpg" }  ];
// var track = _.template('<li data-queue="<%= queuePos %>"><div data-trackid="<%= trackID %>" class="track-info"><img class="album-art" src="<%= albumArt %>"alt="album-art"/><h1 class="tk-nimbus-sans-condensed"><%= title %><span><%= artist %></span></h1> <div class="social-scoring"> <a class="vote-up" href="#">vote-up</a> <p class="tk-nimbus-sans-condensed"><%= score %></p><a class="vote-down" href="#">vote-down</a> </div></div> <div class="pos-bar"><div class="fill-pos" data-pos="<%= currentPosition %>"></div> </div> <div data-userid="<%= userID %>" class="social-info"><img class="user-pic" src="<%= userPic %>" alt="profile-pic"/> <h2 class="tk-franklin-gothic-urw-cond"><%= userName %><em> piq\'d this song</em></h2><a class="share" href="#"><img src="img/share-button.png"/></a></div></li>');

// for (i=0;i<data.length;i++)
// 	{ 
// 		$('ol').append(track(data[i])); 
// 	}


//scrolls past browser search on load
nobrowser = function(){
	var page = document.getElementById('page'),
	    ua = navigator.userAgent,
	    iphone = ~ua.indexOf('iPhone') || ~ua.indexOf('iPod'),
	    ipad = ~ua.indexOf('iPad'),
	    ios = iphone || ipad,
	    fullscreen = window.navigator.standalone,
	    android = ~ua.indexOf('Android'),
	    lastWidth = 0;
	 
	if (android) {
	  window.onscroll = function() {
	    page.style.height = window.innerHeight + 'px'
	  } 
	}
	var setupScroll = window.onload = function() {
	  if (ios) {
	    var height = document.documentElement.clientHeight;
	    if (iphone && !fullscreen) height += 60;
	    page.style.height = height + 'px';
	  } else if (android) {
	    page.style.height = (window.innerHeight + 56) + 'px'
	  }
	  setTimeout(scrollTo, 0, 0, 1);
	};
	(window.onresize = function() {
	  var pageWidth = page.offsetWidth;
	  if (lastWidth == pageWidth) return;
	  lastWidth = pageWidth;
	  setupScroll();
	})();
}

$("ol").append('<div style="height: 52px;"></div'); //adds space so last song isnt covered by search bar

//ajax post request on click of vote up vote down
vote = function(){
	$(".vote-up").click(function(event) {
		var index = $('li').index();
    console.log(index);

		event.preventDefault();
		event.stopPropagation();

		if ($(this).hasClass('vote-up-selected'))
			{
			$(this).removeClass('vote-up-selected');
			}
		else if ($(this).siblings(".vote-down").hasClass('vote-down-selected'))
			{
			$(this).siblings(".vote-down").removeClass('vote-down-selected');
			$(this).addClass("vote-up-selected");
			}
		else 
			{
			$(this).addClass("vote-up-selected");
			}
	});

	$(".vote-down").click(function(event) {
		event.preventDefault();
		event.stopPropagation();
		
		if ($(this).hasClass('vote-down-selected'))
			{
			$(this).removeClass('vote-down-selected');
			}		
		else if ($(this).siblings(".vote-up").hasClass('vote-up-selected'))
			{
			$(this).siblings(".vote-up").removeClass('vote-up-selected');
			$(this).addClass("vote-down-selected");
			}
		else
			{
			$(this).addClass("vote-down-selected");
			}
	});


	// var url = "http://piq.fm/try/vote.php?song_id=" + _.template('<%= trackID %>');
	var base_url = "http://piq.fm/try/vote.php";
	// console.log(url);

	$(".vote-up").click(function(event) {
		event.preventDefault();
		event.stopPropagation();
    var track_id = $(this).parent().parent().data('trackid');
    console.log(track_id);
    var url = base_url + "?song_id=" + track_id;
    console.log(url);
    var voting = $(this).siblings(".vote-count");
    console.log(voting);
		if ($(this).hasClass('vote-up-selected'))
			{
			$(this).removeClass('vote-up-selected');
      console.log(url + "&vote_value=1");
			$.post(url + "&vote_value=1",function(data){
         var vote = data.votes;
         voting.html(vote);
         console.log("Voted" + vote);
      });
			}
		else if ($(this).siblings(".vote-down").hasClass('vote-down-selected'))
			{
			$(this).siblings(".vote-down").removeClass('vote-down-selected');
			$(this).addClass("vote-up-selected");
      console.log(url + "&vote_value=1");
			$.post(url + "&vote_value=1",function(data){
         var vote = data.votes;
         voting.html(vote);
         console.log("Voted" + vote);
      });
			}
		else 
			{
			$(this).addClass("vote-up-selected");
      console.log(url + "&vote_value=1");
			$.post(url + "&vote_value=1", function(data){
         var vote = data.votes;
         voting.html(vote);
         console.log("Voted" + vote);
      });
      console.log($(this));
      }
  });
	$(".vote-down").click(function(event) {
		event.preventDefault();
		event.stopPropagation();
  	var track_id = $(this).parent().parent().data('trackid');
    var url = base_url + "?song_id=" + track_id;
    var voting = $(this).siblings(".vote-count");
		if ($(this).hasClass('vote-down-selected'))
			{
			$(this).removeClass('vote-down-selected');
			$.post(url + "&vote_value=-1", function(data){
         var vote = data.votes;
         voting.html(vote);
      });
			}		
		else if ($(this).siblings(".vote-up").hasClass('vote-up-selected'))
			{
			$(this).siblings(".vote-up").removeClass('vote-up-selected');
			$(this).addClass("vote-down-selected");
			$.post(url + "&vote_value=-1", function(data){
        $(this).siblings(".vote-count").html(data.votes);
        var vote = data.votes;
        voting.html(vote);
      });
			}
		else
			{
			$(this).addClass("vote-down-selected");
			$.post(url + "&vote_value=-1",  function(data){A
        var vote = data.votes;
        voting.html(vote);
    });
			}
	});
}

expand = function(){
	$('ol li:nth-of-type(1)').addClass("expand");


	
	$("li").click(function() {
		var index = $('li').index($(this));


		if ($(this).hasClass("expand expand-np") == true && index != 0)
			{
			$(this).removeClass("expand");
			setTimeout(function(){$("li").get(index).className = ""}, 500);
			}	
		else if ($(this).hasClass("expand expand-np") == false && index != 0)
			{
			$('li:nth-of-type(1n+2)').removeClass("expand expand-np");
			$(this).addClass("expand expand-np");
			}	
	});

}

// function toTop(el){
// 	$('body').animate({
// 		scrollTop: $('#'+el).offset().top
// 	},"slow");
// 	console.log(scrollTop);
// };

// $('#resultsTrack').click(function(){
// 	scrollTo("#fetch");
// });


